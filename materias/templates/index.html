<!DOCTYPE html>
<html>
<head>
    {% load static %}
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Materias</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="container">
        <h1>ðŸ“š Sistema de Materias</h1>
        
        <div class="formulario">
            <h2>Agregar Nueva Materia</h2>
            <form method="POST" onsubmit="return validarFormulario()">
                {% csrf_token %}
                <div class="campo">
                    <label>Nombre de la Materia *</label>
                    <input type="text" name="nombre" id="nombre" placeholder="Ej: MatemÃ¡ticas">
                    <div id="errorNombre" class="error"></div>
                </div>
                
                <div class="campo">
                    <label>Semestre *</label>
                    <select name="semestre" id="semestre">
                        <option value="">Selecciona el semestre</option>
                        {% for i in semesters %}
                            <option value="{{ i }}">{{ i }}Â° Semestre</option>
                        {% endfor %}
                    </select>
                    <div id="errorSemestre" class="error"></div>
                </div>
                
                <div class="campo">
                    <label>Nombre del Profesor *</label>
                    <input type="text" name="profesor" id="profesor" placeholder="Ej: Dr. PÃ©rez">
                    <div id="errorProfesor" class="error"></div>
                </div>
                
                <div class="campo">
                    <label>Comentarios (opcional)</label>
                    <textarea name="comentarios" id="comentarios" placeholder="Observaciones sobre la materia..."></textarea>
                    <div id="errorComentarios" class="error"></div>
                </div>
                
                <button type="submit" class="boton">Guardar Materia</button>
            </form>
        </div>
        
        <div class="contador">Total de materias registradas: {{ materias_count }}</div>
        
        {% if materias %}
            <table class="tabla">
                <thead>
                    <tr>
                        <th>Materia</th>
                        <th>Semestre</th>
                        <th>Profesor</th>
                        <th>Comentarios</th>
                        <th>Fecha</th>
                    </tr>
                </thead>
                <tbody>
                    {% for materia in materias %}
                        <tr>
                            <td>{{ materia.nombre }}</td>
                            <td>{{ materia.semestre }}Â°</td>
                            <td>{{ materia.profesor }}</td>
                            <td>{{ materia.comentarios|default:"-" }}</td>
                            <td>{{ materia.fecha|date:"d/m/Y H:i" }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="sin-materias">No hay materias registradas aÃºn.</p>
        {% endif %}
    </div>
    
    <script>
        function validarFormulario() {
            let valido = true;
            
            // Limpiar errores anteriores
            document.querySelectorAll('.error').forEach(e => e.textContent = '');
            
            // Validar nombre
            const nombre = document.getElementById('nombre').value.trim();
            if (!nombre) {
                document.getElementById('errorNombre').textContent = 'El nombre es obligatorio';
                valido = false;
            }
            
            // Validar semestre
            const semestre = document.getElementById('semestre').value;
            if (!semestre) {
                document.getElementById('errorSemestre').textContent = 'Selecciona un semestre';
                valido = false;
            }
            
            // Validar profesor
            const profesor = document.getElementById('profesor').value.trim();
            if (!profesor) {
                document.getElementById('errorProfesor').textContent = 'El profesor es obligatorio';
                valido = false;
            }
            
            // Validar comentarios (opcional, pero con lÃ­mite)
            const comentarios = document.getElementById('comentarios').value.trim();
            if (comentarios.length > 500) {
                document.getElementById('errorComentarios').textContent = 'MÃ¡ximo 500 caracteres';
                valido = false;
            }
            
            return valido;
        }
        
        // Limpiar errores al escribir
        ['nombre', 'semestre', 'profesor', 'comentarios'].forEach(id => {
            document.getElementById(id).addEventListener('input', function() {
                const errorId = 'error' + id.charAt(0).toUpperCase() + id.slice(1);
                document.getElementById(errorId).textContent = '';
            });
        });
    </script>
</body>
</html>
